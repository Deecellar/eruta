#!/usr/bin/env ruby

def bin2c
  unless ARGV[0]
    puts "bin2c filename"
    return 1
  end
  inname    = ARGV[0]
  outfile   = $stdout
  data      = IO.read(inname, :mode => 'rb')
  name      = inname.gsub(/[^A-Za-z0-9_]+/,'_')   
  size      = data.size
  outfile.printf("#define %s_SIZE %d\n", name.upcase, size)  
  outfile.printf("const uint8_t %s[%d] = \n", name.downcase, size)
  step      = 0 
  data.each_byte do |b| 
    outfile.printf('"')  if(step == 0)        
    outfile.printf("\\x%s",b.to_s(16)) 
    step+=1 
    if step >= 40 
      step = 0 
      outfile.printf("\"\n")
    end
  end    
  outfile.printf("\"") unless step == 0
  outfile.printf("\n;\n") 
  if (outfile != $stdout) 
    outfile.close
  end  
  return 0
end

exit(bin2c)

